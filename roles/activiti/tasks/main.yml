---
- name: Download activiti
  stat: path=/tmp/activiti-{{ activiti_version }}.zip
  register: zip_archive

- get_url:
    url: https://github.com/Activiti/Activiti/releases/download/activiti-{{ activiti_version }}/activiti-{{ activiti_version }}.zip
    dest: /tmp
    validate_certs: false
    timeout: 60
  when: (not zip_archive.stat.exists)

- name: Expand activiti zip
  unarchive:
    src=/tmp/activiti-{{ activiti_version }}.zip
    dest=/tmp
    copy=no
  when: (not zip_archive.stat.exists)

- name: Create target directory
  file: path=/opt/activiti-{{ activiti_version }}/activiti-{{ item }} state=directory mode=0755
  with_items:
    - rest
    - app
    - admin

- name: Expand war
  unarchive:
    src=/tmp/activiti-{{ activiti_version }}/wars/activiti-{{ item }}.war
    dest=/opt/activiti-{{ activiti_version }}/activiti-{{ item }}
    copy=no
  with_items:
    - rest
    - app
    - admin
